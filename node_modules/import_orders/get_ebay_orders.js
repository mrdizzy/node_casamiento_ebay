var eBayAPI = require('./ebay_configuration');

function GetOrdersFromEbay(db, callback) {
    // Get last imported time and begin import
    db.get('time', function(err, res) {
        if (err) {
            console.log("Could not get last imported time: ", err);
        }
        else {
            ImportOrders(res.lastModified, function(jsonResult) {
                callback(jsonResult);
            });
        }
    });
}

function ImportOrders(fromTime, callback) {
    eBayAPI.makeRequest("GetOrders", callback, {
        ModTimeFrom: fromTime,
        ModTimeTo: new Date().toISOString()
    }, "json");
};

module.exports = GetOrdersFromEbay;